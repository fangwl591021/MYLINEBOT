<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<title>名片編輯器</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>

<body>
<h3>名片編輯器</h3>
<input id="name" placeholder="名稱"><br><br>
<input id="subtitle" placeholder="副標"><br><br>
<input id="image" placeholder="主圖 URL"><br><br>
<button onclick="save()">儲存名片</button>

<script>
const GAS_API_URL = 'https://script.google.com/macros/s/AKfycbxUk3hZcUHSROrzVTje-kZMQHB8jQezr6vDt6YDPebOqXbjsdbzDETj99Ed9pzxrSXN/exec'
const LIFF_ID = '2008924519-PkufAIve'
const token = new URLSearchParams(location.search).get('token')

let profile = {}

async function init() {
  await liff.init({ liffId: LIFF_ID })
  if (!liff.isLoggedIn()) {
    liff.login()
    return
  }
  profile = await liff.getProfile()
}
init()

async function save() {
  const card = {
    displayName: profile.displayName,
    pictureUrl: profile.pictureUrl,
    header: {
      avatarUrl: profile.pictureUrl,
      name: name.value,
      subtitle: subtitle.value,
    },
    hero: {
      mode: 'image',
      image: { url: image.value },
    },
    footer: {
      maxButtons: 2,
      buttons: [],
    },
  }

  await fetch(GAS_API_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      action: 'saveCard',
      token,
      card,
    }),
  })

  alert('✅ 名片已儲存，回 LINE 輸入「顯示名片」')
}
</script>
</body>
</html>
