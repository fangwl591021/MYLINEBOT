<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<title>名片編輯器</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>

<body>
<h3>名片編輯器</h3>

<input id="name" placeholder="名稱"><br><br>
<input id="subtitle" placeholder="副標"><br><br>
<input id="image" placeholder="圖片 URL"><br><br>

<button onclick="save()">儲存名片</button>

<script>
const GAS_API_URL = '你的 GAS Web App URL'
const LIFF_ID = '2008924519-PkufAIve'
const token = new URLSearchParams(location.search).get('token')
let profile = {}

async function init() {
  await liff.init({ liffId: LIFF_ID })
  if (!liff.isLoggedIn()) return liff.login()
  profile = await liff.getProfile()
}
init()

async function save() {
  const card = {
    header: {
      avatarUrl: profile.pictureUrl,
      name: name.value,
      subtitle: subtitle.value,
      bgColor: '#1A1B1E',
    },
    hero: {
      mode: 'image',
      image: { url: image.value },
    },
  }

  const res = await fetch(GAS_API_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      action: 'saveCard',
      token,
      card,
    }),
  })

  const data = await res.json()
  if (!data.ok) return alert('❌ 儲存失敗')

  alert('✅ 名片已儲存，請回 LINE 輸入「顯示名片」')
}
</script>
</body>
</html>
