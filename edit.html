<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
<h3>編輯名片</h3>
<input id="name" placeholder="名稱"><br>
<input id="subtitle" placeholder="副標"><br>
<button onclick="save()">儲存</button>

<script>
const LIFF_ID = '2008924519-PkufAIve'
const GAS_API_URL = 'https://script.google.com/macros/s/AKfycbzX7uzA3kIbmgiGwP3HMjyWCCtkZcNV8e7egg4xPkWKXltkXo2Pnmc-L_6v1sUnJyDe/exec'
const token = new URLSearchParams(location.search).get('token')

async function main(){
  await liff.init({ liffId: LIFF_ID })
  if(!liff.isLoggedIn()){ liff.login(); return }
}
main()

async function save(){
  await fetch(GAS_API_URL,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      action:'saveCard',
      token,
      card:{
        name:document.getElementById('name').value,
        subtitle:document.getElementById('subtitle').value,
        avatarUrl:''
      }
    })
  })
  alert('已儲存，回 LINE 輸入「顯示名片」')
  liff.closeWindow()
}
</script>
</body>
</html>
