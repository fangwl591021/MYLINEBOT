<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>名片編輯</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
<div id="app">INIT...</div>

<script>
const LIFF_ID = '2008924519-PkufAIve'
const GAS_API_URL = 'https://script.google.com/macros/s/AKfycby2E7sOjlZ7Ea_A2NnXk-ziyYXjTvGh1ss6kPo2Legmk28CGsH7GfAdatyPmf-sGboP/exec'
const token = new URLSearchParams(location.search).get('token')

init()

async function init() {
  await liff.init({ liffId: LIFF_ID })
  if (!liff.isLoggedIn()) {
    liff.login()
    return
  }

  const profile = await liff.getProfile()

  if (!token) {
    document.getElementById('app').innerHTML =
      `<h3>${profile.displayName}</h3><p>此為顯示模式</p>`
    return
  }

  document.getElementById('app').innerHTML = `
    <input id="name" value="${profile.displayName}">
    <button onclick="save()">儲存</button>
  `
}

async function save() {
  await fetch(GAS_API_URL, {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({
      action:'saveCard',
      token,
      card:{
        header:{
          name:document.getElementById('name').value,
          subtitle:'LINE 名片'
        }
      }
    })
  })
  alert('已儲存')
  liff.closeWindow()
}
</script>
</body>
</html>
