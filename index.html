<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE OA 管理系統 - GitHub 版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        
        :root {
            --line-green: #06C755;
            --line-dark-green: #05b34c;
            --bg-gray: #f4f5f7;
            --sidebar-width: 240px;
            --border-color: #e5e7eb;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-gray);
            overflow: hidden;
        }

        /* 佈局樣式 */
        .sidebar { width: var(--sidebar-width); background-color: #2b303b; color: #ffffff; }
        .sidebar-item { padding: 12px 20px; display: flex; align-items: center; gap: 12px; transition: all 0.2s; color: #a1a1a1; cursor: pointer; }
        .sidebar-item:hover { background-color: #3e4451; color: #ffffff; }
        .sidebar-item.active { background-color: #3e4451; color: #ffffff; border-left: 4px solid var(--line-green); }

        .header { height: 56px; background-color: #ffffff; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; padding: 0 24px; justify-content: space-between; }
        
        /* 頁籤 */
        .tab-btn { padding: 12px 24px; font-weight: 500; color: #6b7280; border-bottom: 2px solid transparent; transition: all 0.2s; }
        .tab-btn.active { color: var(--line-green); border-bottom-color: var(--line-green); }

        /* 聊天室預覽 */
        .chat-room-bg { background-color: #7988a0; height: 100%; overflow-y: auto; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .flex-bubble-container { width: 100%; max-width: 350px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .aspect-1-1 { aspect-ratio: 1 / 1; }
        .aspect-16-9 { aspect-ratio: 16 / 9; }
        .aspect-4-3 { aspect-ratio: 4 / 3; }

        /* 滾動條 */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        .btn-primary { background-color: var(--line-green); color: white; padding: 8px 16px; border-radius: 4px; font-weight: 500; }
        .btn-primary:hover { background-color: var(--line-dark-green); }

        .card-table { width: 100%; background: white; border-collapse: collapse; }
        .card-table th { text-align: left; background-color: #f9fafb; padding: 12px 16px; border-bottom: 1px solid var(--border-color); color: #4b5563; font-size: 14px; }
        .card-table td { padding: 16px; border-bottom: 1px solid var(--border-color); font-size: 14px; }
        
        /* SVG 圖示共用 */
        .icon { width: 20px; height: 20px; stroke-width: 2; stroke: currentColor; fill: none; stroke-linecap: round; stroke-linejoin: round; }
        .icon-sm { width: 16px; height: 16px; }
        .icon-xs { width: 12px; height: 12px; }
    </style>
</head>
<body class="h-screen flex">

    <!-- 圖示庫 (不佔位) -->
    <svg style="display: none;">
        <symbol id="icon-message" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></symbol>
        <symbol id="icon-home" viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></symbol>
        <symbol id="icon-layers" viewBox="0 0 24 24"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></symbol>
        <symbol id="icon-layout" viewBox="0 0 24 24"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" x2="21" y1="9" y2="9"/><line x1="9" x2="9" y1="21" y2="9"/></symbol>
        <symbol id="icon-plus" viewBox="0 0 24 24"><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></symbol>
        <symbol id="icon-chevron-right" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></symbol>
        <symbol id="icon-copy" viewBox="0 0 24 24"><rect width="13" height="13" x="9" y="9" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></symbol>
        <symbol id="icon-image" viewBox="0 0 24 24"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></symbol>
        <symbol id="icon-palette" viewBox="0 0 24 24"><circle cx="13.5" cy="6.5" r=".5"/><circle cx="17.5" cy="10.5" r=".5"/><circle cx="8.5" cy="7.5" r=".5"/><circle cx="6.5" cy="12.5" r=".5"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/></symbol>
        <symbol id="icon-x" viewBox="0 0 24 24"><line x1="18" x2="6" y1="6" y2="18"/><line x1="6" x2="18" y1="6" y2="18"/></symbol>
        <symbol id="icon-play" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></symbol>
    </svg>

    <!-- 側邊導覽列 -->
    <aside class="sidebar h-full flex flex-col shrink-0 z-30 shadow-xl">
        <div class="p-6 flex items-center gap-3">
            <div class="bg-line-green p-1.5 rounded-lg text-white">
                <svg class="icon"><use href="#icon-message"/></svg>
            </div>
            <span class="font-bold text-lg tracking-tight">OA 管理系統</span>
        </div>
        <nav class="flex-1 mt-4">
            <div class="sidebar-item" onclick="location.reload()"><svg class="icon"><use href="#icon-home"/></svg> 首頁儀表板</div>
            <div class="sidebar-item active"><svg class="icon"><use href="#icon-layers"/></svg> 多頁訊息模組</div>
            <div class="sidebar-item"><svg class="icon"><use href="#icon-layout"/></svg> 圖文選單管理</div>
        </nav>
        <div class="p-4 bg-black/10 text-[10px] text-gray-400 text-center">Version 1.2.0 Stable</div>
    </aside>

    <div class="flex-1 flex flex-col overflow-hidden">
        <!-- 頂部 Header -->
        <header class="header shrink-0 shadow-sm z-20">
            <div class="flex items-center gap-2 text-sm text-gray-500">
                <span>內容管理</span> 
                <svg class="icon icon-xs"><use href="#icon-chevron-right"/></svg>
                <span class="text-gray-900 font-medium" id="header-title">多頁訊息</span>
            </div>
            <div id="editor-actions" class="hidden flex gap-2">
                <button onclick="exitEditor()" class="px-4 py-1.5 text-sm font-bold text-slate-600 border border-slate-300 rounded hover:bg-slate-100 transition">取消返回</button>
                <button onclick="exportJSON()" class="px-4 py-1.5 text-sm font-bold text-white bg-slate-900 rounded hover:bg-slate-800 flex items-center gap-2 transition shadow-md">
                    <svg class="icon icon-sm"><use href="#icon-copy"/></svg> 複製 JSON
                </button>
            </div>
        </header>

        <!-- 列表視圖 -->
        <main id="view-list" class="flex-1 overflow-y-auto p-8">
            <div class="max-w-6xl mx-auto">
                <div class="flex justify-between items-end mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">訊息內容管理</h2>
                        <p class="text-gray-500 text-sm mt-1">您可以建立、編輯並預覽 LINE Flex Message 模組。</p>
                    </div>
                    <button onclick="enterEditor()" class="btn-primary flex items-center gap-2 transition shadow-lg">
                        <svg class="icon icon-sm"><use href="#icon-plus"/></svg> 建立新訊息
                    </button>
                </div>

                <!-- 模組切換頁籤 -->
                <div class="bg-white rounded-t-lg border-b border-gray-200 flex overflow-hidden">
                    <button onclick="switchListTab('product')" id="tab-product" class="tab-btn active">商品模組</button>
                    <button onclick="switchListTab('single')" id="tab-single" class="tab-btn">單頁模組</button>
                    <button onclick="switchListTab('multi')" id="tab-multi" class="tab-btn">多頁模組</button>
                </div>

                <!-- 資料表格 -->
                <div class="bg-white rounded-b-lg shadow-sm overflow-hidden border border-t-0 border-gray-200">
                    <table class="card-table">
                        <thead>
                            <tr>
                                <th>模組名稱</th>
                                <th>內容摘要</th>
                                <th>最後更新</th>
                                <th>當前狀態</th>
                                <th>操作選項</th>
                            </tr>
                        </thead>
                        <tbody id="table-body">
                            <!-- JS 動態插入 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>

        <!-- 編輯器視圖 -->
        <main id="view-editor" class="flex-1 hidden overflow-hidden flex">
            <!-- 左側編輯面板 -->
            <aside class="w-[420px] bg-white border-r border-slate-200 overflow-y-auto p-5 space-y-6 custom-scrollbar shadow-inner">
                <!-- Hero 設定 -->
                <div class="border border-slate-200 rounded-xl overflow-hidden shadow-sm bg-white">
                    <div class="p-3 bg-slate-50 border-b border-slate-200 font-bold text-slate-700 text-sm flex items-center gap-2">
                        <svg class="icon icon-sm text-slate-400"><use href="#icon-image"/></svg> 頂部視覺 (Hero)
                    </div>
                    <div class="p-4 space-y-4">
                        <div class="flex bg-slate-100 p-1 rounded-lg border border-slate-200">
                            <button onclick="updateHeroType('image')" id="btn-type-image" class="flex-1 py-1.5 text-xs font-bold rounded-md transition">圖片</button>
                            <button onclick="updateHeroType('video')" id="btn-type-video" class="flex-1 py-1.5 text-xs font-bold rounded-md transition">影片</button>
                            <button onclick="updateHeroType('none')" id="btn-type-none" class="flex-1 py-1.5 text-xs font-bold rounded-md transition">無</button>
                        </div>
                        <div class="space-y-3" id="hero-inputs">
                            <div>
                                <label class="text-[11px] font-bold text-slate-500 uppercase block mb-1">顯示比例</label>
                                <select id="hero-aspect" onchange="updateConfig('heroAspect', this.value)" class="w-full text-xs p-2.5 border border-slate-300 rounded-lg outline-none focus:ring-2 focus:ring-line-green/20 focus:border-line-green transition">
                                    <option value="16:9">16:9 (寬螢幕)</option>
                                    <option value="1:1">1:1 (正方形)</option>
                                    <option value="4:3">4:3 (矩形)</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-[11px] font-bold text-slate-500 uppercase block mb-1">素材連結網址</label>
                                <input type="text" id="input-hero-url" oninput="updateConfig('heroUrl', this.value)" class="w-full text-xs p-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-line-green/20 focus:border-line-green transition outline-none" placeholder="https://...">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 商品清單 -->
                <div class="border border-slate-200 rounded-xl overflow-hidden shadow-sm bg-white">
                    <div class="p-3 bg-slate-50 border-b border-slate-200 font-bold text-slate-700 text-sm flex justify-between items-center">
                        <div class="flex items-center gap-2"><svg class="icon icon-sm text-slate-400"><use href="#icon-palette"/></svg> 商品內容設定</div>
                        <select onchange="state.body.columns=parseInt(this.value);renderPreview();" class="text-[10px] border border-slate-300 rounded px-2 py-1 outline-none">
                            <option value="3">3 欄展示</option>
                            <option value="4">4 欄展示</option>
                        </select>
                    </div>
                    <div class="p-4 space-y-3">
                        <div id="items-container" class="space-y-3">
                            <!-- JS 動態插入項目 -->
                        </div>
                        <button onclick="addItem()" class="w-full py-3 border-2 border-dashed border-slate-300 rounded-xl text-slate-500 text-xs font-bold hover:border-line-green hover:text-line-green hover:bg-emerald-50 transition-all flex items-center justify-center gap-2">
                            <svg class="icon icon-xs"><use href="#icon-plus"/></svg> 新增商品項目
                        </button>
                    </div>
                </div>

                <!-- Footer 按鈕 -->
                <div class="border border-slate-200 rounded-xl overflow-hidden shadow-sm bg-white">
                    <div class="p-3 bg-slate-50 border-b border-slate-200 font-bold text-slate-700 text-sm">底部操作按鈕</div>
                    <div class="p-4 space-y-4">
                        <input type="text" id="input-btn1" oninput="state.footer.btn1.label=this.value;renderPreview();" class="w-full text-xs p-2.5 border border-slate-300 rounded-lg outline-none" placeholder="按鈕 1 名稱">
                        <input type="text" id="input-btn2" oninput="state.footer.btn2.label=this.value;renderPreview();" class="w-full text-xs p-2.5 border border-slate-300 rounded-lg outline-none" placeholder="按鈕 2 名稱">
                    </div>
                </div>
            </aside>

            <!-- 右側即時預覽 -->
            <section class="flex-1 chat-room-bg custom-scrollbar relative">
                <div class="sticky top-0 w-full text-center py-4 pointer-events-none z-10">
                    <span class="bg-black/20 backdrop-blur-md text-white text-[10px] px-4 py-1.5 rounded-full font-bold tracking-widest border border-white/10 shadow-lg">REAL-TIME PREVIEW</span>
                </div>
                
                <div class="flex items-start gap-2 w-full justify-center mt-4 mb-20">
                    <!-- 模擬頭像 -->
                    <div class="w-9 h-9 rounded-full bg-slate-400 shrink-0 shadow-sm border border-white/20"></div>
                    
                    <!-- 氣泡內容 -->
                    <div class="flex-bubble-container bg-white rounded-2xl overflow-hidden flex flex-col">
                        <!-- Hero 區 -->
                        <div id="view-hero-container" class="relative w-full bg-black overflow-hidden shrink-0">
                            <img id="view-hero-img" src="" class="w-full h-full object-cover hidden">
                            <div id="view-video-ui" class="absolute inset-0 flex items-center justify-center hidden">
                                <div class="w-14 h-14 bg-white/90 rounded-full flex items-center justify-center shadow-2xl">
                                    <svg style="fill: #111;" class="icon text-slate-900 ml-1"><use href="#icon-play"/></svg>
                                </div>
                            </div>
                        </div>

                        <!-- Body 區 -->
                        <div class="p-4 bg-slate-50 border-b border-slate-100" id="view-body-container">
                            <div class="grid gap-2" id="view-grid"></div>
                        </div>

                        <!-- Footer 區 -->
                        <div class="p-3 flex flex-col gap-2 shrink-0 bg-white">
                            <div class="flex gap-2 w-full">
                                <button id="view-btn-1" class="flex-1 py-2.5 rounded-lg text-[11px] font-bold text-white bg-slate-900 hover:opacity-90 transition shadow-sm"></button>
                                <button id="view-btn-2" class="flex-1 py-2.5 rounded-lg text-[11px] font-bold text-white bg-slate-900 hover:opacity-90 transition shadow-sm"></button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- 提示框 -->
    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-slate-800 text-white px-8 py-3.5 rounded-full shadow-2xl text-sm font-medium opacity-0 transition-all duration-300 pointer-events-none z-50 transform translate-y-4">
        JSON 已成功複製至剪貼簿
    </div>

    <script>
        // 模擬資料庫內容
        const mockListData = {
            product: [
                { name: '2025 春季熱門選物', desc: '包含 6 項嚴選商品', date: '2025/01/15 14:00', status: '使用中' },
                { name: '新年福袋組合', desc: '商品模組：4 項', date: '2025/01/10 09:30', status: '草稿' }
            ],
            single: [
                { name: '加入好友自動回覆', desc: '單頁導引訊息', date: '2024/12/20 11:20', status: '使用中' }
            ],
            multi: [
                { name: '週年慶輪播目錄', desc: '12 頁滾動卡片', date: '2025/01/12 18:45', status: '已排程' }
            ]
        };

        // 編輯器狀態
        let state = {
            hero: { type: 'image', aspectRatio: '16:9', url: "https://lihi.cc/5OXMZ" },
            body: { columns: 3, items: [
                { title: "經典商品 A", img: "https://lihi.cc/mwMvo" },
                { title: "質感選物 B", img: "https://lihi.cc/2Nu8G" },
                { title: "限時優惠 C", img: "https://lihi.cc/yRfpn" }
            ]},
            footer: { 
                btn1: { label: "前往官網" }, 
                btn2: { label: "領取優惠" } 
            }
        };

        // 切換列表視圖與編輯器
        function enterEditor() {
            document.getElementById('view-list').classList.add('hidden');
            document.getElementById('view-editor').classList.remove('hidden');
            document.getElementById('editor-actions').classList.remove('hidden');
            syncUI();
            renderPreview();
        }

        function exitEditor() {
            document.getElementById('view-list').classList.remove('hidden');
            document.getElementById('view-editor').classList.add('hidden');
            document.getElementById('editor-actions').classList.add('hidden');
        }

        function switchListTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            renderTable(tab);
        }

        function renderTable(tab) {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = mockListData[tab].map(item => `
                <tr class="hover:bg-slate-50 transition cursor-default">
                    <td class="font-bold text-slate-800">${item.name}</td>
                    <td class="text-slate-500 text-xs">${item.desc}</td>
                    <td class="text-slate-400 text-xs">${item.date}</td>
                    <td><span class="px-2.5 py-1 rounded-full text-[10px] bg-green-100 text-green-700 font-bold">${item.status}</span></td>
                    <td><button onclick="enterEditor()" class="text-blue-600 font-bold text-xs hover:underline">編輯模組</button></td>
                </tr>
            `).join('');
        }

        // 編輯器邏輯
        function updateHeroType(type) {
            state.hero.type = type;
            syncUI();
            renderPreview();
        }

        function updateConfig(path, value) {
            if(path === 'heroAspect') state.hero.aspectRatio = value;
            if(path === 'heroUrl') state.hero.url = value;
            renderPreview();
        }

        function addItem() {
            state.body.items.push({ title: "新商品項目", img: "https://lihi.cc/mwMvo" });
            syncUI();
            renderPreview();
        }

        function syncUI() {
            const active = "bg-white shadow-md text-line-green border border-line-green";
            const inactive = "text-slate-500 hover:bg-slate-200";
            
            document.getElementById('btn-type-image').className = `flex-1 py-1.5 text-xs font-bold rounded-md transition ${state.hero.type==='image'?active:inactive}`;
            document.getElementById('btn-type-video').className = `flex-1 py-1.5 text-xs font-bold rounded-md transition ${state.hero.type==='video'?active:inactive}`;
            document.getElementById('btn-type-none').className = `flex-1 py-1.5 text-xs font-bold rounded-md transition ${state.hero.type==='none'?active:inactive}`;
            
            document.getElementById('input-hero-url').value = state.hero.url;
            document.getElementById('input-btn1').value = state.footer.btn1.label;
            document.getElementById('input-btn2').value = state.footer.btn2.label;

            const container = document.getElementById('items-container');
            container.innerHTML = state.body.items.map((item, i) => `
                <div class="p-3 bg-slate-50 border border-slate-200 rounded-xl relative shadow-sm group">
                    <button onclick="state.body.items.splice(${i},1);syncUI();renderPreview();" class="absolute -top-2 -right-2 w-6 h-6 bg-white border border-slate-200 rounded-full flex items-center justify-center text-slate-400 hover:text-red-500 shadow-sm transition">
                        <svg class="icon icon-xs"><use href="#icon-x"/></svg>
                    </button>
                    <input type="text" value="${item.title}" oninput="state.body.items[${i}].title=this.value;renderPreview();" class="w-full text-[11px] p-2 border border-slate-200 rounded-lg mb-2 focus:ring-1 focus:ring-line-green outline-none" placeholder="商品名稱">
                    <input type="text" value="${item.img}" oninput="state.body.items[${i}].img=this.value;renderPreview();" class="w-full text-[10px] p-2 border border-slate-200 rounded-lg focus:ring-1 focus:ring-line-green outline-none font-mono" placeholder="圖片連結">
                </div>
            `).join('');
        }

        function renderPreview() {
            const heroCont = document.getElementById('view-hero-container');
            const heroImg = document.getElementById('view-hero-img');
            const videoUi = document.getElementById('view-video-ui');
            const ratioMap = { '1:1': 'aspect-1-1', '16:9': 'aspect-16-9', '4:3': 'aspect-4-3' };

            heroCont.className = `relative w-full bg-black overflow-hidden shrink-0 ${ratioMap[state.hero.aspectRatio]}`;
            if(state.hero.type === 'none') heroCont.classList.add('hidden');
            else {
                heroCont.classList.remove('hidden');
                if(state.hero.type === 'image') { heroImg.src = state.hero.url; heroImg.classList.remove('hidden'); videoUi.classList.add('hidden'); }
                else { heroImg.classList.add('hidden'); videoUi.classList.remove('hidden'); }
            }

            const grid = document.getElementById('view-grid');
            grid.className = `grid gap-2 grid-cols-${state.body.columns}`;
            grid.innerHTML = state.body.items.map(item => `
                <div class="bg-white rounded-lg p-1.5 shadow-sm flex flex-col border border-slate-100">
                    <div class="aspect-square bg-slate-100 rounded-md overflow-hidden mb-1.5 border border-slate-200"><img src="${item.img}" class="w-full h-full object-cover"></div>
                    <div class="text-[9px] bg-slate-800 text-white text-center py-1 rounded font-bold truncate tracking-tight">${item.title}</div>
                </div>
            `).join('');

            document.getElementById('view-btn-1').innerText = state.footer.btn1.label;
            document.getElementById('view-btn-2').innerText = state.footer.btn2.label;
        }

        function exportJSON() {
            // 構建精簡的 Flex JSON 格式
            const flex = {
                type: "bubble",
                hero: state.hero.type !== 'none' ? { type: "image", url: state.hero.url, size: "full", aspectRatio: state.hero.aspectRatio, aspectMode: "cover" } : undefined,
                body: {
                    type: "box", layout: "vertical", contents: [{
                        type: "box", layout: "vertical", spacing: "sm", contents: state.body.items.map(i => ({ type: "text", text: i.title }))
                    }]
                }
            };
            const el = document.createElement('textarea');
            el.value = JSON.stringify(flex, null, 2); 
            document.body.appendChild(el); 
            el.select(); 
            document.execCommand('copy'); 
            document.body.removeChild(el);
            
            const toast = document.getElementById('toast');
            toast.style.opacity = '1'; 
            toast.classList.remove('translate-y-4');
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.classList.add('translate-y-4');
            }, 2500);
        }

        window.onload = () => {
            switchListTab('product');
        };
    </script>
</body>
</html>
